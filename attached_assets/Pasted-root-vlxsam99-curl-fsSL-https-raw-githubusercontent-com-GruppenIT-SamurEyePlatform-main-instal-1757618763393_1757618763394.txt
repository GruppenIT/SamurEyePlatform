root@vlxsam99:~# curl -fsSL https://raw.githubusercontent.com/GruppenIT/SamurEyePlatform/main/install.sh | sudo bash

[INFO] ==========================================
[INFO]   SamurEye - InstalaÃ§Ã£o AutomÃ¡tica v1.0
[INFO] ==========================================

[INFO] DistribuiÃ§Ã£o detectada: ubuntu 24.04
[INFO] Iniciando instalaÃ§Ã£o em Thu Sep 11 07:25:24 PM UTC 2025
[INFO] Atualizando repositÃ³rios do sistema...
Hit:1 http://br.archive.ubuntu.com/ubuntu noble InRelease
Hit:2 http://br.archive.ubuntu.com/ubuntu noble-updates InRelease
Hit:3 http://br.archive.ubuntu.com/ubuntu noble-backports InRelease
Hit:4 https://deb.nodesource.com/node_20.x nodistro InRelease
Hit:5 http://security.ubuntu.com/ubuntu noble-security InRelease
Reading package lists... Done
Building dependency tree... Done
Reading state information... Done
6 packages can be upgraded. Run 'apt list --upgradable' to see them.
Reading package lists... Done
Building dependency tree... Done
Reading state information... Done
Calculating upgrade... Done
The following upgrades have been deferred due to phasing:
  bind9-dnsutils bind9-host bind9-libs openssh-client openssh-server openssh-sftp-server
0 upgraded, 0 newly installed, 0 to remove and 6 not upgraded.
[INFO] Instalando dependÃªncias bÃ¡sicas do sistema...
Reading package lists... Done
Building dependency tree... Done
Reading state information... Done
curl is already the newest version (8.5.0-2ubuntu10.6).
wget is already the newest version (1.21.4-1ubuntu4.1).
git is already the newest version (1:2.43.0-1ubuntu7.3).
unzip is already the newest version (6.0-28ubuntu4.1).
build-essential is already the newest version (12.10ubuntu1).
software-properties-common is already the newest version (0.99.49.3).
apt-transport-https is already the newest version (2.8.3).
ca-certificates is already the newest version (20240203).
gnupg is already the newest version (2.4.4-2ubuntu17.3).
lsb-release is already the newest version (12.0-2).
ufw is already the newest version (0.36.2-6).
htop is already the newest version (3.3.0-4build1).
tree is already the newest version (2.1.1-2ubuntu3).
jq is already the newest version (1.7.1-3ubuntu0.24.04.1).
openssl is already the newest version (3.0.13-0ubuntu3.5).
net-tools is already the newest version (2.10-0.1ubuntu4.4).
python3 is already the newest version (3.12.3-0ubuntu2).
0 upgraded, 0 newly installed, 0 to remove and 6 not upgraded.
[INFO] DependÃªncias bÃ¡sicas instaladas com sucesso
[INFO] Instalando Node.js 20...
Reading package lists... Done
Building dependency tree... Done
Reading state information... Done
Package 'npm' is not installed, so not removed
The following packages will be REMOVED:
  nodejs
0 upgraded, 0 newly installed, 1 to remove and 6 not upgraded.
After this operation, 197 MB disk space will be freed.
(Reading database ... 136366 files and directories currently installed.)
Removing nodejs (20.19.5-1nodesource1) ...
Processing triggers for man-db (2.12.0-4build2) ...
2025-09-11 19:25:33 - Installing pre-requisites
Hit:1 http://br.archive.ubuntu.com/ubuntu noble InRelease
Hit:2 http://br.archive.ubuntu.com/ubuntu noble-updates InRelease
Hit:3 http://br.archive.ubuntu.com/ubuntu noble-backports InRelease
Hit:4 https://deb.nodesource.com/node_20.x nodistro InRelease
Hit:5 http://security.ubuntu.com/ubuntu noble-security InRelease
Reading package lists... Done
Reading package lists... Done
Building dependency tree... Done
Reading state information... Done
apt-transport-https is already the newest version (2.8.3).
ca-certificates is already the newest version (20240203).
curl is already the newest version (8.5.0-2ubuntu10.6).
gnupg is already the newest version (2.4.4-2ubuntu17.3).
0 upgraded, 0 newly installed, 0 to remove and 6 not upgraded.
Hit:1 http://br.archive.ubuntu.com/ubuntu noble InRelease
Hit:2 http://br.archive.ubuntu.com/ubuntu noble-updates InRelease
Hit:3 http://br.archive.ubuntu.com/ubuntu noble-backports InRelease
Hit:4 https://deb.nodesource.com/node_20.x nodistro InRelease
Hit:5 http://security.ubuntu.com/ubuntu noble-security InRelease
Reading package lists... Done
2025-09-11 19:25:39 - Repository configured successfully.
2025-09-11 19:25:39 - To install Node.js, run: apt-get install nodejs -y
2025-09-11 19:25:39 - You can use N|solid Runtime as a node.js alternative
2025-09-11 19:25:39 - To install N|solid Runtime, run: apt-get install nsolid -y

Reading package lists... Done
Building dependency tree... Done
Reading state information... Done
The following NEW packages will be installed:
  nodejs
0 upgraded, 1 newly installed, 0 to remove and 6 not upgraded.
Need to get 32.0 MB of archives.
After this operation, 197 MB of additional disk space will be used.
Get:1 https://deb.nodesource.com/node_20.x nodistro/main amd64 nodejs amd64 20.19.5-1nodesource1 [32.0 MB]
Fetched 32.0 MB in 5s (6,652 kB/s)
Selecting previously unselected package nodejs.
(Reading database ... 131003 files and directories currently installed.)
Preparing to unpack .../nodejs_20.19.5-1nodesource1_amd64.deb ...
Unpacking nodejs (20.19.5-1nodesource1) ...
Setting up nodejs (20.19.5-1nodesource1) ...
Processing triggers for man-db (2.12.0-4build2) ...
Scanning processes...
Scanning candidates...
Scanning linux images...

Pending kernel upgrade!
Running kernel version:
  6.8.0-41-generic
Diagnostics:
  The currently running kernel version is not the expected kernel version 6.8.0-79-generic.

Restarting the system to load the new kernel will not be handled automatically, so you should consider rebooting.

Restarting services...

Service restarts being deferred:
 /etc/needrestart/restart.d/dbus.service
 systemctl restart getty@tty1.service
 systemctl restart systemd-logind.service
 systemctl restart unattended-upgrades.service

No containers need to be restarted.

No user sessions are running outdated binaries.

No VM guests are running outdated hypervisor (qemu) binaries on this host.
[INFO] Node.js v20.19.5 e npm 10.8.2 instalados com sucesso
[INFO] Instalando PostgreSQL...
Reading package lists... Done
Building dependency tree... Done
Reading state information... Done
postgresql is already the newest version (16+257build1.1).
postgresql-contrib is already the newest version (16+257build1.1).
postgresql-client is already the newest version (16+257build1.1).
0 upgraded, 0 newly installed, 0 to remove and 6 not upgraded.
Synchronizing state of postgresql.service with SysV service script with /usr/lib/systemd/systemd-sysv-install.
Executing: /usr/lib/systemd/systemd-sysv-install enable postgresql
[INFO] PostgreSQL instalado e iniciado com sucesso
[INFO] ğŸ”„ HARD RESET: Recriando banco de dados PostgreSQL...
[INFO] ğŸ—‘ï¸ Removendo banco de dados existente...
DROP DATABASE
[INFO] ğŸ—‘ï¸ Removendo usuÃ¡rio do banco existente...
DROP ROLE
[INFO] ğŸ‘¤ Criando novo usuÃ¡rio do banco de dados...
CREATE ROLE
ALTER ROLE
[INFO] ğŸ—ï¸ Criando novo banco de dados...
CREATE DATABASE
ALTER ROLE
[INFO] âœ… Banco de dados recriado com sucesso
[INFO] ğŸ”‘ Nova senha do banco gerada
[INFO] Instalando Nginx...
Reading package lists... Done
Building dependency tree... Done
Reading state information... Done
nginx is already the newest version (1.24.0-2ubuntu7.5).
0 upgraded, 0 newly installed, 0 to remove and 6 not upgraded.
Synchronizing state of nginx.service with SysV service script with /usr/lib/systemd/systemd-sysv-install.
Executing: /usr/lib/systemd/systemd-sysv-install enable nginx
[INFO] Nginx instalado com sucesso
[INFO] Instalando ferramentas de seguranÃ§a...
Reading package lists... Done
Building dependency tree... Done
Reading state information... Done
nmap is already the newest version (7.94+git20230807.3be01efb1+dfsg-3build2).
0 upgraded, 0 newly installed, 0 to remove and 6 not upgraded.
Reading package lists... Done
Building dependency tree... Done
Reading state information... Done
smbclient is already the newest version (2:4.19.5+dfsg-4ubuntu9.3).
ldap-utils is already the newest version (2.6.7+dfsg-1~exp1ubuntu8.2).
0 upgraded, 0 newly installed, 0 to remove and 6 not upgraded.
[INFO] Ferramentas de seguranÃ§a instaladas com sucesso
[INFO] Configurando usuÃ¡rio do sistema...
[INFO] UsuÃ¡rio samureye jÃ¡ existe
[INFO] Configurando firewall UFW...
[INFO] Porta SSH detectada: 22
[INFO] Configurando firewall automaticamente (modo nÃ£o-interativo):
[INFO] - SSH permitido na porta 22
[INFO] - HTTP (80) e HTTPS (443) permitidos
[INFO] - AplicaÃ§Ã£o (5000) bloqueada externamente
Backing up 'user.rules' to '/etc/ufw/user.rules.20250911_192559'
Backing up 'before.rules' to '/etc/ufw/before.rules.20250911_192559'
Backing up 'after.rules' to '/etc/ufw/after.rules.20250911_192559'
Backing up 'user6.rules' to '/etc/ufw/user6.rules.20250911_192559'
Backing up 'before6.rules' to '/etc/ufw/before6.rules.20250911_192559'
Backing up 'after6.rules' to '/etc/ufw/after6.rules.20250911_192559'

Default incoming policy changed to 'deny'
(be sure to update your rules accordingly)
Default outgoing policy changed to 'allow'
(be sure to update your rules accordingly)
Rules updated
Rules updated (v6)
Rules updated
Rules updated (v6)
Rules updated
Rules updated (v6)
Rules updated
Rules updated (v6)
Firewall is active and enabled on system startup
[INFO] Firewall configurado com sucesso
[INFO] Baixando e instalando aplicaÃ§Ã£o SamurEye...
[INFO] Parando serviÃ§os existentes...
[INFO] Preservando backups existentes...
[INFO] Removendo instalaÃ§Ã£o anterior...
[INFO] Clonando repositÃ³rio...
Cloning into '.'...
remote: Enumerating objects: 388, done.
remote: Counting objects: 100% (388/388), done.
remote: Compressing objects: 100% (203/203), done.
remote: Total 388 (delta 233), reused 333 (delta 178), pack-reused 0 (from 0)
Receiving objects: 100% (388/388), 382.25 KiB | 4.11 MiB/s, done.
Resolving deltas: 100% (233/233), done.
[INFO] Restaurando backups preservados...
[INFO] Instalando dependÃªncias da aplicaÃ§Ã£o...
npm warn config production Use `--omit=dev` instead.
npm warn deprecated @esbuild-kit/esm-loader@2.6.5: Merged into tsx: https://tsx.is
npm warn deprecated @esbuild-kit/core-utils@3.3.2: Merged into tsx: https://tsx.is

added 512 packages, and audited 513 packages in 8s

69 packages are looking for funding
  run `npm fund` for details

8 vulnerabilities (1 low, 7 moderate)

To address issues that do not require attention, run:
  npm audit fix

To address all issues (including breaking changes), run:
  npm audit fix --force

Run `npm audit` for details.
[INFO] Aplicando correÃ§Ãµes do driver de banco de dados...

up to date, audited 513 packages in 2s

69 packages are looking for funding
  run `npm fund` for details

8 vulnerabilities (1 low, 7 moderate)

To address issues that do not require attention, run:
  npm audit fix

To address all issues (including breaking changes), run:
  npm audit fix --force

Run `npm audit` for details.

up to date, audited 513 packages in 2s

69 packages are looking for funding
  run `npm fund` for details

8 vulnerabilities (1 low, 7 moderate)

To address issues that do not require attention, run:
  npm audit fix

To address all issues (including breaking changes), run:
  npm audit fix --force

Run `npm audit` for details.

changed 7 packages, and audited 513 packages in 4s

69 packages are looking for funding
  run `npm fund` for details

8 vulnerabilities (1 low, 7 moderate)

To address issues that do not require attention, run:
  npm audit fix

To address all issues (including breaking changes), run:
  npm audit fix --force

Run `npm audit` for details.

up to date, audited 513 packages in 2s

69 packages are looking for funding
  run `npm fund` for details

8 vulnerabilities (1 low, 7 moderate)

To address issues that do not require attention, run:
  npm audit fix

To address all issues (including breaking changes), run:
  npm audit fix --force

Run `npm audit` for details.
[INFO] âœ… Driver PostgreSQL (pg) instalado com sucesso
[INFO] Compilando aplicaÃ§Ã£o...

> rest-express@1.0.0 build
> vite build && esbuild server/index.ts --platform=node --packages=external --bundle --format=esm --outdir=dist

vite v5.4.19 building for production...
transforming (9) src/hooks/useAuth.tsBrowserslist: browsers data (caniuse-lite) is 11 months old. Please run:
  npx update-browserslist-db@latest
  Why you should do it regularly: https://github.com/browserslist/update-db#readme
âœ“ 1754 modules transformed.
../dist/public/index.html                   2.20 kB â”‚ gzip:   0.86 kB
../dist/public/assets/index-B33ibakt.css   62.13 kB â”‚ gzip:  11.21 kB
../dist/public/assets/index-BipKPYHK.js   554.13 kB â”‚ gzip: 158.05 kB

(!) Some chunks are larger than 500 kB after minification. Consider:
- Using dynamic import() to code-split the application
- Use build.rollupOptions.output.manualChunks to improve chunking: https://rollupjs.org/configuration-options/#output-manualchunks
- Adjust chunk size limit for this warning via build.chunkSizeWarningLimit.
âœ“ built in 5.95s

  dist/index.js  121.6kb

âš¡ Done in 13ms
[INFO] âœ… Build da aplicaÃ§Ã£o finalizado com sucesso
[WARN] âš ï¸  Script de produÃ§Ã£o pode nÃ£o estar configurado corretamente
[INFO] âœ… Driver PostgreSQL (pg) disponÃ­vel no node_modules
[INFO] AplicaÃ§Ã£o instalada com sucesso
[INFO] Configurando variÃ¡veis de ambiente...
[INFO] VariÃ¡veis de ambiente configuradas
[INFO] Executando migraÃ§Ãµes do banco de dados...

> rest-express@1.0.0 db:push
> drizzle-kit push

No config path provided, using default 'drizzle.config.ts'
Reading config file '/opt/samureye/drizzle.config.ts'
Using 'pg' driver for database querying
[âœ“] Pulling schema from database...
[âœ“] Changes applied
npm notice
npm notice New major version of npm available! 10.8.2 -> 11.6.0
npm notice Changelog: https://github.com/npm/cli/releases/tag/v11.6.0
npm notice To update run: npm install -g npm@11.6.0
npm notice
[INFO] MigraÃ§Ãµes executadas com sucesso
[INFO] ğŸ”„ HARD RESET: Criando novo usuÃ¡rio administrador...
[INFO] ğŸ—‘ï¸ Removendo usuÃ¡rios administradores existentes...
DELETE 0
[INFO] ğŸ†• Criando novo usuÃ¡rio administrador: admin@samureye.com.br
tr: warning: an unescaped backslash at end of string is not portable
[INFO] Senha temporÃ¡ria gerada: 16 caracteres
[INFO] Gerando hash seguro da senha...
[INFO] Hash gerado com 60 caracteres
[INFO] ğŸ‘¤ Inserindo novo usuÃ¡rio administrador no banco...
[ERROR] Falha ao inserir usuÃ¡rio administrador
root@vlxsam99:~#